---
layout: post
title: A Simple Hash For Perlin Noise
tag: Game Dev ðŸ‘¾
---

I needed a hashing algorithm that is simple to implement and quick to compute, to be used as a basis
for generating perlin noise in Unity.

I couldn't rely on simple randomness since terrain generation has to be deterministic, especially for multiplayer games.

## Fowlerâ€“Nollâ€“Vo 1a

I ended up implementing the [Fowlerâ€“Nollâ€“Vo 1a hash](http://www.isthe.com/chongo/tech/comp/fnv/index.html), which is known for trading some quality for increased performance. It was designed to be fast, not secure - which is exactly what is needed in the context of procedural generation.

Let me first show you what it looks like (you can use the `DebugTexture()` method in the code at the bottom of this post to get a sample texture). These images are generated by hashing the coordinates of each pixel and mapping that hash to a color between black and white:

![Hash with tricks]({% link assets/2022-05-10-a-simple-hash-for-perlin-noise/hash-with-tricks.jpg %}){: width="400px" }

I used a couple tricks to get the hash to look as close as possible to white noise when passing in sequential numbers starting from 0 or near 0.

The first trick is to multiply each coordinate by one of the algorithm's parameters (the prime number), which gets the bits away from being almost all 0s when hashing low values.

The second trick is to hash the bytes in a random sequence. This sequence is hardcoded for simplicity.

Without these two tricks, the hash looks much less like pure white noise. This is the result if we hash the coordinates as floating point numbers, using no tricks:

![Hash without tricks from floats]({% link assets/2022-05-10-a-simple-hash-for-perlin-noise/hash-without-tricks.jpg %}){: width="400px" }

And this if we hash coordinates as integers, also with no tricks:

![Hash without tricks from integers]({% link assets/2022-05-10-a-simple-hash-for-perlin-noise/hash-without-tricks-int.jpg %}){: width="400px" }

The full source code is below:

<script src="https://gist.github.com/marcospgp/ed991372f1c814eb21b8b248db258187.js"></script>

## A 2023 update

This post is mainly about getting around patterns showing up when hashing consecutive numbers. This is a result of the FNV hash having poor avalanche properties.

A simpler alternative I found to work around this is to hash twice when hashing coordinates. Doing this for each coordinate separately or with bytes concatenated didn't result in a noticeable difference.
